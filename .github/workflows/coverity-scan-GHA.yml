name: Go scan

on:
    push:
     branches:
      - main
    workflow_dispatch:

permissions:
    id-token: write
    contents: read

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Compile Code
        run: echo "Compiling..."

      - name: Produce Binary
        run: sleep 5

      - name: Push binary
        run: echo "Pushing Binary to ECR..."

      - name: Check out repository code
        uses: actions/checkout@v3

      - name: Scan with Coverity on Polaris
        uses: cloudbees-io-gha/coverity-scan-publish@v2
        with: 
          step-id: "coverity-scan"
          server-url: ${{ vars.COVERITY_POLARIS_SERVER_URL }}
          api-token: ${{ secrets.COVERITY_POLARIS_TOKEN }}
         
